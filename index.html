<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NW App 2026</title>
    
    <link rel="manifest" href="manifest.json">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="./icons/192.png">
    
    <style>
        body { font-family: sans-serif; text-align: center; padding: 50px; }
        #installBtn { 
            display: none; /* é è¨­éš±è—ï¼Œåªæœ‰æ”¯æ´å®‰è£æ™‚æ‰é¡¯ç¤º */ 
            padding: 15px 30px; 
            background-color: #007bff; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            font-size: 18px; 
            cursor: pointer; 
        }
    </style>
</head>
<body>

    <h1>æ­¡è¿ä½¿ç”¨æˆ‘çš„ App</h1>
    <p>é»æ“Šä¸‹æ–¹æŒ‰éˆ•å°‡æ­¤é é¢å®‰è£åˆ°æ‰‹æ©Ÿæ¡Œé¢ã€‚</p>
    
    <button id="installBtn">ğŸ“² å®‰è£ App åˆ°æ¡Œé¢</button>
    
    <div style="margin-top:24px">
      <h2>RTSP ä¸²æµï¼ˆä»¥ VLC é–‹å•Ÿï¼‰</h2>
      <input id="rtspUrl" type="text" value="rtsp://192.168.137.152/stream1" style="width:100%;max-width:520px;padding:10px;margin-top:8px">
      <div style="margin-top:12px">
        <button id="openVLCBtn" style="padding:12px 18px;background:#ff4136;color:#fff;border-radius:6px;border:none;cursor:pointer">ç”¨ VLC é–‹å•Ÿ</button>
      </div>
      <p id="vlcMsg" style="font-size:14px;opacity:.8;margin-top:8px"></p>
    </div>

    <script>
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');
        const openVLCBtn = document.getElementById('openVLCBtn');
        const rtspInput = document.getElementById('rtspUrl');
        const vlcMsg = document.getElementById('vlcMsg');
        function isiOS() {
            const ua = navigator.userAgent.toLowerCase();
            return /iphone|ipad|ipod/.test(ua);
        }
        function isAndroidChrome() {
            const ua = navigator.userAgent.toLowerCase();
            return ua.includes('android') && ua.includes('chrome');
        }
        function isStandalone() {
            return window.matchMedia('(display-mode: standalone)').matches || navigator.standalone === true;
        }
        function openVLC() {
            const raw = rtspInput.value.trim();
            if (!raw) return;
            const iosScheme = 'vlc-x-callback://x-callback-url/stream?url=' + encodeURIComponent(raw);
            const androidScheme = 'vlc://' + encodeURIComponent(raw);
            const desktopScheme = 'vlc://' + encodeURIComponent(raw);
            const href = isiOS() ? iosScheme : (isAndroidChrome() ? androidScheme : desktopScheme);
            vlcMsg.textContent = 'å˜—è©¦ä»¥ VLC é–‹å•Ÿä¸²æµâ€¦';
            window.location.href = href;
            setTimeout(() => {
                vlcMsg.textContent = 'è‹¥æœªé–‹å•Ÿï¼Œè«‹ç¢ºèªå·²å®‰è£ VLC ä¸¦å…è¨±ä»¥é€£çµå•Ÿå‹•ã€‚';
            }, 1200);
        }

        // ç›£è½ç€è¦½å™¨çš„å®‰è£äº‹ä»¶ (Android/Chrome)
        window.addEventListener('beforeinstallprompt', (e) => {
            // é˜²æ­¢ç€è¦½å™¨ç›´æ¥è·³å‡ºé è¨­çš„å®‰è£æç¤ºå°æ¢
            e.preventDefault();
            // æŠŠäº‹ä»¶å­˜èµ·ä¾†ï¼Œç¨å¾Œè§¸ç™¼
            deferredPrompt = e;
            // é¡¯ç¤ºå®‰è£æŒ‰éˆ•
            installBtn.style.display = 'block';
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                // è§¸ç™¼å®‰è£æç¤º
                deferredPrompt.prompt();
                // ç­‰å¾…ä½¿ç”¨è€…å›æ‡‰
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`ä½¿ç”¨è€…å›æ‡‰: ${outcome}`);
                // æ¸…é™¤äº‹ä»¶
                deferredPrompt = null;
            } else {
                if (isiOS()) {
                    alert('åœ¨ Safari é»æ“Šåˆ†äº«åœ–ç¤ºï¼Œé¸æ“‡ã€ŒåŠ å…¥ä¸»ç•«é¢ã€ã€‚');
                } else if (isAndroidChrome()) {
                    alert('åœ¨ Chrome é»æ“Šå³ä¸Šè§’ã€Œâ‹®ã€ï¼Œé¸æ“‡ã€Œå®‰è£æ‡‰ç”¨ç¨‹å¼ã€ã€‚');
                } else {
                    alert('è«‹ä½¿ç”¨æ”¯æ´ PWA çš„ç€è¦½å™¨ï¼ˆå¦‚ Chromeï¼‰ï¼Œä¸¦ç¢ºèªéç„¡ç—•æ¨¡å¼ã€‚');
                }
            }
        });

        // è¨»å†Š Service Worker (PWA å¿…é ˆ)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
        document.addEventListener('DOMContentLoaded', () => {
            openVLCBtn.addEventListener('click', openVLC);
            if (!isStandalone() && (isiOS() || isAndroidChrome())) {
                installBtn.style.display = 'block';
            }
            console.log('[PWA]', {
                isiOS: isiOS(),
                isAndroidChrome: isAndroidChrome(),
                isStandalone: isStandalone()
            });
        });
    </script>
</body>
</html>
